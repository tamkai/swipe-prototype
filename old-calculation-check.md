# 旧バージョンのスコア計算で検証

## 修正前のscoreCalculator.js（バグ版）

```javascript
'動機': { pole_a: '内発', pole_b: '目的整合' },  // 正しい
'生成': { pole_a: '発散', pole_b: '収束' },      // 正しい
'進行': { pole_a: '柔軟', pole_b: '粘り' },      // 正しい
'価値創出': { pole_a: '改善', pole_b: '発明' }, // ← バグ！逆！
'表現': { pole_a: '自己表現', pole_b: '共感価値' }, // 正しい
'思考': { pole_a: '抽象', pole_b: '具体' },      // 正しい
'実行': { pole_a: '即興', pole_b: '設計' },      // 正しい
'協働': { pole_a: '単独集中', pole_b: '協働駆動' } // 正しい
```

## 価値創出を旧バージョンで再計算

### swipe_history:
1. 飛躍（pole: 発明）- match
2. 創造（pole: 発明）- not_match of 最適化
3. 大胆な挑戦（pole: 発明）- match
4. イノベーション（pole: 発明）- not_match of ブラッシュアップ

### 旧バージョンの計算（バグあり）:
```javascript
pole_a = '改善', pole_b = '発明'  // ← 逆！

1. 飛躍（pole: 発明）- match
   → item.pole === pole_b → score -= 1  // -1

2. 創造（pole: 発明）- not_match
   → item.pole === pole_b → score += 1  // +1 - 1 = 0

3. 大胆な挑戦（pole: 発明）- match
   → item.pole === pole_b → score -= 1  // 0 - 1 = -1

4. イノベーション（pole: 発明）- not_match
   → item.pole === pole_b → score += 1  // -1 + 1 = 0
```

**最終スコア**: 0
**正規化**: (0 + 4) / 8 = **0.5**

**DB値**: 0.00

❌ **まだ合わない！DBは0.00だが、旧計算でも0.5になる**

---

## さらなる可能性: 最大スコアの計算間違い？

再確認：正規化の式は `(score + maxScore) / (maxScore * 2)`

各軸は4問 → maxScore = 4
- 正規化: (score + 4) / 8

スコア0の場合: (0 + 4) / 8 = 0.5 ← 正しい

---

## 🔍 新たな仮説: 異なる計算ロジックが使われていた？

DBに保存されている0.00という値は、以下の可能性：

1. **初期値として0.00が保存された**
   - スコア計算が実行されなかった
   - または計算エラーでデフォルト値0.00が使われた

2. **異なる正規化式が使われていた**
   - 例: `score / maxScore` のような単純な式
   - score = -4の場合: -4 / 4 = -1.0
   - これを0.0にクリップした？

3. **pole_aとpole_bの判定が完全に逆**
   - 例: pole_bに該当する場合に +1 していた

---

## テスト: score = -4 の場合の各種正規化

### 現行の式: `(score + 4) / 8`
- (-4 + 4) / 8 = 0 / 8 = **0.0** ✅ **これだ！**

### 再計算（旧バージョン、全部matchで計算）:

価値創出で全部「発明」を match した場合（実際のケース）:

**旧バージョン（pole_a='改善', pole_b='発明'）:**
```
1. 飛躍（pole: 発明 = pole_b）- match → score -= 1
2. 創造を選択（最適化 not_match） → 創造のpole: 発明 = pole_b
   JSONには「最適化」のnot_matchが記録される
   実際には「創造」を選んだ = 発明を選んだ

待って...swipe_historyの構造を再確認する必要がある
```

---

## 🚨 重要: swipe_historyの実データを再確認

価値創出の4つのエントリ:

```json
{
  "pole": "発明",
  "keyword": "飛躍",
  "compareTo": "積み重ね",
  "dimension": "価値創出",
  "direction": "match"
}
```
→ 「飛躍」を選んだ（発明側）

```json
{
  "pole": "改善",
  "keyword": "最適化",
  "compareTo": "創造",
  "dimension": "価値創出",
  "direction": "not_match"
}
```
→ 「最適化」を拒否 = 「創造」を選んだ（発明側）
→ **poleは「改善」と記録されている（拒否された側）**

```json
{
  "pole": "発明",
  "keyword": "大胆な挑戦",
  "compareTo": "継続的改善",
  "dimension": "価値創出",
  "direction": "match"
}
```
→ 「大胆な挑戦」を選んだ（発明側）

```json
{
  "pole": "改善",
  "keyword": "ブラッシュアップ",
  "compareTo": "イノベーション",
  "dimension": "価値創出",
  "direction": "not_match"
}
```
→ 「ブラッシュアップ」を拒否 = 「イノベーション」を選んだ（発明側）
→ **poleは「改善」と記録されている（拒否された側）**

---

## 旧バージョンでの正しい計算

```javascript
pole_a = '改善', pole_b = '発明'  // バグ版

1. 飛躍（pole: 発明 = pole_b）- match
   → pole_b → score -= 1  // score = -1

2. 最適化（pole: 改善 = pole_a）- not_match
   → pole_a → score -= 1  // score = -2

3. 大胆な挑戦（pole: 発明 = pole_b）- match
   → pole_b → score -= 1  // score = -3

4. ブラッシュアップ（pole: 改善 = pole_a）- not_match
   → pole_a → score -= 1  // score = -4
```

**最終スコア**: -4
**正規化**: (-4 + 4) / 8 = **0.0** ✅ **完全一致！**

---

## 結論

### ✅ DB値 0.00 の理由が判明

旧バージョンのバグにより:
- pole_a = '改善', pole_b = '発明' （逆）
- 「発明」を選ぶたびに score -= 1
- 4問すべて「発明」寄りを選択 → score = -4
- 正規化: (-4 + 4) / 8 = **0.0**（改善側の端）

### ✅ 修正後の期待値

修正版では:
- pole_a = '発明', pole_b = '改善' （正しい）
- 「発明」を選ぶたびに score += 1（または改善 not_match で +1）
- 4問すべて「発明」寄り → score = +4
- 正規化: (4 + 4) / 8 = **1.0**（発明側の端）

### 🎯 他の軸の不一致の理由

**仮説**: すべての軸で同様の問題があるわけではない。
- 価値創出**だけ**がpole定義逆転していた
- 他の軸のDB値不一致は、以下の可能性:
  1. ユーザーの選択が完全にはっきりしていない（中間的な選択）
  2. 手動計算時のミス
  3. JSONデータの解釈ミス

実際にコードを修正して、**新しく診断を実行**することで検証できます。
